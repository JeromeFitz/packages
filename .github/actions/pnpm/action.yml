# name: 'pnpm'
name: 'ğŸ”’  '
description: 'pnpm lockfile hack'
author: 'JeromeFitz'

inputs:
  IS_ACTOR_VERIFIED:
    description: 'Flag if GitHub Actor is verified (JeromeFitz||Dependabot) ğŸ‘±ğŸ» || ğŸ¤–'
    default: false
    type: boolean
  IS_ACTOR_JEROMEFITZ:
    description: 'Flag if GitHub Actor is JeromeFitz ğŸ‘±ğŸ»'
    required: false
    default: false
    type: boolean
  IS_ACTOR_DEPENDABOT:
    description: 'Flag if GitHub Actor is Dependabot ğŸ¤–'
    required: false
    default: false
    type: boolean
  IS_LABEL_PNPM:
    description: 'Flag if Label `ğŸ“¦ pnpm` is applied ğŸ·ï¸'
    default: false
    type: boolean

runs:
  using: 'composite'
  steps:
    - name: 'ğŸššğŸ’¨ debug'
      id: pnpm-debug
      shell: bash
      run: |
        echo 'IS_ACTOR_VERIFIED: ${{ inputs.IS_ACTOR_VERIFIED }}'
        echo 'IS_ACTOR_JEROMEFITZ: ${{ inputs.IS_ACTOR_JEROMEFITZ }}'
        echo 'IS_ACTOR_DEPENDABOT: ${{ inputs.IS_ACTOR_DEPENDABOT }}'
        echo 'IS_LABEL_PNPM: ${{ inputs.IS_LABEL_PNPM }}'

    - name: 'ğŸ”§ git config'
      id: pnpm-git-config
      if: ${{ inputs.IS_ACTOR_DEPENDABOT == 'true' || inputs.IS_LABEL_PNPM == 'true' }}
      shell: bash
      run: |
        git --version
        git config --global user.name BotJerome
        git config --global user.email bot@jeromefitzgerald.com

    - name: 'ğŸ“¦ install'
      id: pnpm-install
      if: ${{ inputs.IS_ACTOR_DEPENDABOT == 'true' || inputs.IS_LABEL_PNPM == 'true' }}
      shell: bash
      run: |
        pnpm install --lockfile-only
        git add pnpm-lock.yaml

    - name: 'ğŸ”’ git update'
      id: pnpm-git-update
      if: ${{ inputs.IS_ACTOR_DEPENDABOT == 'true' || inputs.IS_LABEL_PNPM == 'true' }}
      shell: bash
      # note: should remove pnpm label if it exists if we create a commit
      run: |
        if [[ $(git status -s | egrep "^M" | wc -l) -eq 1 ]]; then git commit -m "ğŸ’š (pnpm) pnpm-lock.yaml ğŸ”’" && git push; else git --version; fi
